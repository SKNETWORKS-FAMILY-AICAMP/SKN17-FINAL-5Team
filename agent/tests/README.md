# ν…μ¤νΈ κ°€μ΄λ“ π“

> μ΄ λ¬Έμ„λ” ν”„λ΅μ νΈμ ν…μ¤νΈ μ½”λ“λ¥Ό μ‘μ„±ν•κ³  μ‹¤ν–‰ν•λ” λ°©λ²•μ„ μ„¤λ…ν•©λ‹λ‹¤.
> ν…μ¤νΈλ¥Ό μ²μ μ ‘ν•μ‹λ” λ¶„λ“¤λ„ μ‰½κ² λ”°λΌν•  μ μλ„λ΅ μ‘μ„±λμ—μµλ‹λ‹¤.

---

## π“ ν…μ¤νΈλ€?

ν…μ¤νΈλ” **μ°λ¦¬κ°€ μ‘μ„±ν• μ½”λ“κ°€ μ λ€λ΅ μ‘λ™ν•λ”μ§€ μλ™μΌλ΅ ν™•μΈ**ν•λ” μ½”λ“μ…λ‹λ‹¤.

### μ™ ν…μ¤νΈλ¥Ό μ‘μ„±ν•λ‚μ”?
- β… μ½”λ“ μμ • μ‹ κΈ°μ΅΄ κΈ°λ¥μ΄ κΉ¨μ§€λ”μ§€ λΉ λ¥΄κ² ν™•μΈ
- β… λ²„κ·Έλ¥Ό λ―Έλ¦¬ λ°κ²¬ν•μ—¬ λ°°ν¬ μ „ μμ • κ°€λ¥
- β… ν‘μ—… μ‹ λ‹¤λ¥Έ ν€μ›μ μ½”λ“ λ³€κ²½μΌλ΅ μΈν• μ¤λ¥ λ°©μ§€
- β… μ½”λ“ μ‹ λΆ°λ„ ν–¥μƒ

---

## π€ λΉ λ¥Έ μ‹μ‘

### 1λ‹¨κ³„: ν•„μ”ν• ν¨ν‚¤μ§€ μ„¤μΉ

```bash
pip install pytest pytest-cov pytest-asyncio
```

### 2λ‹¨κ³„: ν…μ¤νΈ μ‹¤ν–‰

ν”„λ΅μ νΈ λ£¨νΈ λ””λ ‰ν† λ¦¬(`SKN-17-Final-5Team/`)μ—μ„ μ‹¤ν–‰ν•μ„Έμ”:

```bash
# λ¨λ“  ν…μ¤νΈ μ‹¤ν–‰
pytest

# λ” μμ„Έν• μ¶λ ¥ λ³΄κΈ° (κ¶μ¥)
pytest -v

# νΉμ • νμΌλ§ ν…μ¤νΈ
pytest tests/test_utils.py

# μ‹¤ν¨ν• ν…μ¤νΈλ§ λ‹¤μ‹ μ‹¤ν–‰
pytest --lf
```

### 3λ‹¨κ³„: κ²°κ³Ό ν™•μΈ

**μ„±κ³µ μμ‹:**
```
tests/test_utils.py::test_dedup_consecutive_lines β“β“β“β“β“ PASSED
tests/test_config.py::test_qdrant_client_exists β“β“β“β“β“ PASSED

========== 12 passed in 0.45s ==========
```

**μ‹¤ν¨ μμ‹:**
```
tests/test_utils.py::test_something β—β—β—β—β— FAILED

AssertionError: assert 'hello' == 'world'
```

---

## π“‚ ν…μ¤νΈ νμΌ κµ¬μ΅°

```
tests/
β”β”€β”€ __init__.py                   # ν…μ¤νΈ ν¨ν‚¤μ§€ λ§μ»¤ (κ±΄λ“λ¦¬μ§€ μ•μ•„λ„ λ¨)
β”β”€β”€ conftest.py                   # κ³µν†µ μ„¤μ • λ° μ¬μ‚¬μ© κ°€λ¥ν• λ°μ΄ν„°
β”β”€β”€ test_utils.py                 # utils.pyμ ν•¨μλ“¤ ν…μ¤νΈ
β”β”€β”€ test_reranker_models.py       # Pydantic λ¨λΈ κ²€μ¦ ν…μ¤νΈ
β”β”€β”€ test_config.py                # μ„¤μ • νμΌ λ΅λ”© ν…μ¤νΈ
β”β”€β”€ test_agent.py                 # Agent μ΄κΈ°ν™” λ° ν”„λ΅¬ν”„νΈ λ΅λ”© ν…μ¤νΈ
β””β”€β”€ README.md                     # μ΄ λ¬Έμ„
```

### κ° νμΌμ΄ ν…μ¤νΈν•λ” λ‚΄μ©

| νμΌ | ν…μ¤νΈ λ€μƒ | μ„¤λ… |
|------|------------|------|
| `test_utils.py` | μ ν‹Έλ¦¬ν‹° ν•¨μ | μ¤‘λ³µ μ κ±°, λ¬Έμ„ μ¶λ ¥ λ“± ν—¬νΌ ν•¨μ κ²€μ¦ |
| `test_reranker_models.py` | Pydantic λ¨λΈ | API μ”μ²­/μ‘λ‹µ λ°μ΄ν„° ν•μ‹ κ²€μ¦ |
| `test_config.py` | μ„¤μ • λ΅λ”© | ν™κ²½λ³€μ, ν΄λΌμ΄μ–ΈνΈ μ΄κΈ°ν™” ν™•μΈ |
| `test_agent.py` | Agent μ„¤μ • | Agentκ°€ μ¬λ°”λ¥΄κ² μƒμ„±λκ³  ν”„λ΅¬ν”„νΈκ°€ λ΅λ“λλ”μ§€ ν™•μΈ |

---

## π› οΈ μ»¤λ²„λ¦¬μ§€ λ¦¬ν¬νΈ (μ½”λ“ κ²€μ¦λ¥ )

**μ»¤λ²„λ¦¬μ§€**λ” μ „μ²΄ μ½”λ“ μ¤‘ ν…μ¤νΈκ°€ μ‹¤ν–‰λ λΉ„μ¨μ„ μλ―Έν•©λ‹λ‹¤.

### μ»¤λ²„λ¦¬μ§€ ν™•μΈ λ°©λ²•

```bash
# ν„°λ―Έλ„μ— κ°„λ‹¨ν μ¶λ ¥
pytest --cov=.

# HTML λ¦¬ν¬νΈ μƒμ„± (λ” λ³΄κΈ° μΆ‹μ)
pytest --cov=. --cov-report=html
```

### HTML λ¦¬ν¬νΈ λ³΄λ” λ²•

1. μ„ λ…λ Ή μ‹¤ν–‰ ν›„ `htmlcov/` ν΄λ”κ°€ μƒμ„±λ¨
2. `htmlcov/index.html` νμΌμ„ λΈλΌμ°μ €λ΅ μ—΄κΈ°
3. κ° νμΌλ³„λ΅ μ–΄λ–¤ μ¤„μ΄ ν…μ¤νΈλμ—λ”μ§€ μ‹κ°μ μΌλ΅ ν™•μΈ κ°€λ¥

**μμ‹ μ¶λ ¥:**
```
Name                Stmts   Miss  Cover
---------------------------------------
config.py              25      2    92%
utils.py               15      0   100%
tools/search_tool.py   45      5    89%
---------------------------------------
TOTAL                 85      7    92%
```

---

## π§ κ³µν†µ Fixture μ‚¬μ©λ²•

`conftest.py`μ—λ” **μ—¬λ¬ ν…μ¤νΈμ—μ„ μ¬μ‚¬μ© κ°€λ¥ν• μƒν” λ°μ΄ν„°μ™€ Mock κ°μ²΄**κ°€ μ •μλμ–΄ μμµλ‹λ‹¤.

### Fixtureλ€?

ν…μ¤νΈ ν•¨μμ— μλ™μΌλ΅ μ „λ‹¬λλ” **λ―Έλ¦¬ μ¤€λΉ„λ λ°μ΄ν„°λ‚ κ°μ²΄**μ…λ‹λ‹¤.
λ§¤λ² κ°™μ€ μƒν” λ°μ΄ν„°λ¥Ό λ§λ“¤ ν•„μ” μ—†μ΄ μ¬μ‚¬μ©ν•  μ μμµλ‹λ‹¤.

### μ‚¬μ© κ°€λ¥ν• Fixture λ©λ΅

| Fixture μ΄λ¦„ | μ©λ„ | μ‚¬μ© μμ‹ |
|-------------|------|----------|
| `sample_qdrant_points` | Qdrant κ²€μƒ‰ κ²°κ³Ό μƒν” (5κ° λ¬Έμ„) | κ²€μƒ‰ κ²°κ³Ό μ²λ¦¬ λ΅μ§ ν…μ¤νΈ |
| `sample_rerank_response` | Reranker API μ‘λ‹µ μƒν” | API μ‘λ‹µ νμ‹± λ΅μ§ ν…μ¤νΈ |
| `mock_openai_client` | OpenAI ν΄λΌμ΄μ–ΈνΈ Mock | API νΈμ¶ μ—†μ΄ ν•¨μ λ™μ‘ ν…μ¤νΈ |
| `mock_qdrant_client` | Qdrant ν΄λΌμ΄μ–ΈνΈ Mock | DB μ—°κ²° μ—†μ΄ κ²€μƒ‰ λ΅μ§ ν…μ¤νΈ |

### Fixture μ‚¬μ© μμ‹

```python
def test_λ¬Έμ„_μ¶λ ¥(sample_qdrant_points):
    """sample_qdrant_points fixtureλ¥Ό μλ™μΌλ΅ λ°›μ•„μ„ μ‚¬μ©"""
    print_retrieved_documents(sample_qdrant_points, n=3)
    # μ‹¤μ  DBμ— μ—°κ²°ν•μ§€ μ•κ³ λ„ ν…μ¤νΈ κ°€λ¥!
```

---

## βοΈ μƒ ν…μ¤νΈ μ‘μ„±ν•κΈ°

### κΈ°λ³Έ ν…μ¤νΈ μ‘μ„± ν¨ν„΄

```python
def test_λ‚΄κ°€_ν…μ¤νΈν• _κΈ°λ¥():
    """λ¬΄μ—‡μ„ ν…μ¤νΈν•λ”μ§€ μ„¤λ…"""
    # 1. μ¤€λΉ„(Arrange): ν…μ¤νΈμ— ν•„μ”ν• λ°μ΄ν„° μ¤€λΉ„
    input_data = "test input"

    # 2. μ‹¤ν–‰(Act): ν…μ¤νΈν•  ν•¨μ μ‹¤ν–‰
    result = my_function(input_data)

    # 3. κ²€μ¦(Assert): κ²°κ³Όκ°€ μμƒκ³Ό μΌμΉν•λ”μ§€ ν™•μΈ
    assert result == "expected output"
```

### μμ™Έ μ²λ¦¬ ν…μ¤νΈ

```python
def test_μλ»λ_μ…λ ¥μ‹_μ—λ¬_λ°μƒ():
    """μλ»λ μ…λ ¥μ— λ€ν•΄ ValueErrorκ°€ λ°μƒν•λ”μ§€ ν™•μΈ"""
    with pytest.raises(ValueError):
        my_function(invalid_input=-1)
```

### Mockμ„ μ‚¬μ©ν• μ™Έλ¶€ API ν…μ¤νΈ

```python
def test_API_νΈμ¶_λ΅μ§(mock_openai_client):
    """μ‹¤μ  APIλ¥Ό νΈμ¶ν•μ§€ μ•κ³  λ΅μ§λ§ ν…μ¤νΈ"""
    # mock_openai_clientλ” κ°€μ§ OpenAI ν΄λΌμ΄μ–ΈνΈ
    # μ‹¤μ  API ν‚¤λ‚ λ„¤νΈμ›ν¬ μ—†μ΄λ„ ν…μ¤νΈ κ°€λ¥
    result = function_using_api(mock_openai_client)
    assert result is not None
```

---

## π”§ ν…μ¤νΈ μ‹¤ν–‰ μµμ… μ΄μ •λ¦¬

| λ…λ Ήμ–΄ | μ„¤λ… |
|--------|------|
| `pytest` | λ¨λ“  ν…μ¤νΈ μ‹¤ν–‰ |
| `pytest -v` | κ° ν…μ¤νΈ μ΄λ¦„κ³Ό κ²°κ³Όλ¥Ό μμ„Έν μ¶λ ¥ |
| `pytest -s` | print λ¬Έ μ¶λ ¥ λ³΄κΈ° (λ””λ²„κΉ…μ©) |
| `pytest -x` | μ²« μ‹¤ν¨ μ‹ μ¦‰μ‹ μ¤‘λ‹¨ |
| `pytest --lf` | λ§μ§€λ§‰ μ‹¤ν¨ν• ν…μ¤νΈλ§ λ‹¤μ‹ μ‹¤ν–‰ |
| `pytest tests/test_utils.py` | νΉμ • νμΌλ§ ν…μ¤νΈ |
| `pytest tests/test_utils.py::test_dedup` | νΉμ • ν…μ¤νΈ ν•¨μλ§ μ‹¤ν–‰ |
| `pytest --cov=.` | μ»¤λ²„λ¦¬μ§€ μΈ΅μ • |
| `pytest --cov=. --cov-report=html` | HTML μ»¤λ²„λ¦¬μ§€ λ¦¬ν¬νΈ μƒμ„± |
| `pytest -k "utils"` | μ΄λ¦„μ— "utils"κ°€ ν¬ν•¨λ ν…μ¤νΈλ§ μ‹¤ν–‰ |

---

## π¨ μμ£Ό λ°μƒν•λ” λ¬Έμ  ν•΄κ²°

### 1. `ModuleNotFoundError: No module named 'pytest'`

**μ›μΈ:** pytestκ°€ μ„¤μΉλμ§€ μ•μ•μµλ‹λ‹¤.

**ν•΄κ²°:**
```bash
pip install pytest pytest-cov pytest-asyncio
```

### 2. `ImportError: cannot import name 'something'`

**μ›μΈ:** ν”„λ΅μ νΈ λ£¨νΈ λ””λ ‰ν† λ¦¬κ°€ μ•„λ‹ κ³³μ—μ„ μ‹¤ν–‰ν–μµλ‹λ‹¤.

**ν•΄κ²°:**
```bash
# ν”„λ΅μ νΈ λ£¨νΈλ΅ μ΄λ™ ν›„ μ‹¤ν–‰
cd /Users/hoon/Desktop/SKN-17-Final-5Team
pytest
```

### 3. `.env` νμΌ κ΄€λ ¨ μ—λ¬

**μ›μΈ:** ν™κ²½λ³€μκ°€ μ„¤μ •λμ§€ μ•μ•μµλ‹λ‹¤.

**ν•΄κ²°:**
ν”„λ΅μ νΈ λ£¨νΈμ— `.env` νμΌμ΄ μλ”μ§€ ν™•μΈν•κ³ , λ‹¤μ λ³€μλ“¤μ΄ μ„¤μ •λμ–΄ μλ”μ§€ ν™•μΈ:
```
OPENAI_API_KEY=your-key
QDRANT_URL=your-url
QDRANT_API_KEY=your-key
```

### 4. νΉμ • ν…μ¤νΈλ§ κ³„μ† μ‹¤ν¨ν•  λ•

**λ””λ²„κΉ… λ°©λ²•:**
```bash
# μ‹¤ν¨ν• ν…μ¤νΈλ§ μμ„Έν λ³΄κΈ°
pytest tests/test_utils.py::test_my_function -v -s
```

`-s` μµμ…μ„ μ¶”κ°€ν•λ©΄ ν…μ¤νΈ μ•μ `print()` λ¬Έμ΄ μ¶λ ¥λμ–΄ λ””λ²„κΉ…μ— λ„μ›€μ΄ λ©λ‹λ‹¤.

---

## π¤ ν‘μ—… μ‹ ν…μ¤νΈ κ·μΉ™

### μƒ κΈ°λ¥μ„ μ¶”κ°€ν•  λ•

1. **κΈ°λ¥ κµ¬ν„** β†’ μƒλ΅μ΄ ν•¨μλ‚ ν΄λμ¤ μ‘μ„±
2. **ν…μ¤νΈ μ‘μ„±** β†’ ν•΄λ‹Ή κΈ°λ¥μ΄ μ¬λ°”λ¥΄κ² μ‘λ™ν•λ”μ§€ ν™•μΈν•λ” ν…μ¤νΈ μ¶”κ°€
3. **ν…μ¤νΈ μ‹¤ν–‰** β†’ `pytest -v`λ΅ λ¨λ“  ν…μ¤νΈκ°€ ν†µκ³Όν•λ”μ§€ ν™•μΈ
4. **μ»¤λ°‹ μ „ ν™•μΈ** β†’ λ°λ“μ‹ ν…μ¤νΈλ¥Ό μ‹¤ν–‰ν•κ³  λ¨λ‘ ν†µκ³Όν• ν›„ μ»¤λ°‹

### Pull Request μ „ μ²΄ν¬λ¦¬μ¤νΈ

- [ ] λ¨λ“  ν…μ¤νΈκ°€ ν†µκ³Όν•λ”μ§€ ν™•μΈ (`pytest -v`)
- [ ] μƒλ΅μ΄ κΈ°λ¥μ— λ€ν• ν…μ¤νΈ μ‘μ„± μ™„λ£
- [ ] μ»¤λ²„λ¦¬μ§€κ°€ 80% μ΄μƒμΈμ§€ ν™•μΈ (`pytest --cov=.`)
- [ ] λ¶ν•„μ”ν• print λ¬Έ μ κ±°

---

## π”„ CI/CD μλ™ν™” (μ„ νƒμ‚¬ν•­)

GitHub Actionsλ¥Ό μ‚¬μ©ν•λ©΄ **μ½”λ“λ¥Ό pushν•  λ•λ§λ‹¤ μλ™μΌλ΅ ν…μ¤νΈ**κ°€ μ‹¤ν–‰λ©λ‹λ‹¤.

### μ„¤μ • λ°©λ²•

`.github/workflows/test.yml` νμΌμ„ ν”„λ΅μ νΈ λ£¨νΈμ— μƒμ„±:

```yaml
name: Tests
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: μ½”λ“ μ²΄ν¬μ•„μ›ƒ
        uses: actions/checkout@v3

      - name: Python μ„¤μΉ
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: μμ΅΄μ„± μ„¤μΉ
        run: |
          pip install -r requirements.txt
          pip install pytest pytest-cov pytest-asyncio

      - name: ν…μ¤νΈ μ‹¤ν–‰
        run: pytest --cov=. --cov-report=term
```

μ΄λ ‡κ² μ„¤μ •ν•λ©΄ GitHubμ—μ„ μλ™μΌλ΅ ν…μ¤νΈ κ²°κ³Όλ¥Ό ν™•μΈν•  μ μμµλ‹λ‹¤! β¨

---

## π“ λ” κ³µλ¶€ν•κΈ°

- [pytest κ³µμ‹ λ¬Έμ„](https://docs.pytest.org/)
- [pytest ν•κµ­μ–΄ νν† λ¦¬μ–Ό](https://pytest-with-eric.com/)
- [Python Mock κ°μ²΄ μ‚¬μ©λ²•](https://docs.python.org/3/library/unittest.mock.html)

---

**λ¬Έμμ‚¬ν•­μ΄ μμΌλ©΄ ν€ μ±„λ„μ— μ§λ¬Έν•΄μ£Όμ„Έμ”!** π™‹β€β™‚οΈ
